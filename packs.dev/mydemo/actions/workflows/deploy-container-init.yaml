version: 1.0

description: deploy-container-init

input:
  - working_dir
  - branch

tasks:
  checkout:
    action: >
      core.local
      cmd="sudo git checkout <% ctx().branch %>"
      cwd=<% ctx().working_dir %>
    next:
      - when: <% succeeded() %>
        do: pull
      - when: <% failed() %>
        publish: msg=<% result().stderr %>

  pull:
    action: core.local 
    input:
      cmd: sudo git pull
      cwd: <% ctx().working_dir %>
    next:
      - when: <% succeeded() %>
        publish: msg=<% result().stdout %>
      - when: <% failed() %>
        publish: msg=<% result().stderr %>

output:
  - output: <% ctx().msg %>
